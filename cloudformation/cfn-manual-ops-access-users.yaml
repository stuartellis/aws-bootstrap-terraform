AWSTemplateFormatVersion: "2010-09-09"
Description: |
  Create AWS resources for interactive Ops access
Parameters:
  UserName:
    Type: String
    Description: Unique name for the user account
  UserEmail:
    Type: String
    Description: Unique email address for the user account
  Prefix:
    Type: String
    Description: The prefix for AWS resource names
  ProjectName:
    Type: String
    Description: The name of the project
  Environment:
    Type: String
    Description: The name of the environment
  ManualOpsAccountManagedPolicyName:
    Type: String
    Default: AdministratorAccess
    Description: The name of the IAM policy to apply

Resources:
  ManualAccessGroup:
    Type: AWS::IAM::Group
    Properties: 
      GroupName: !Sub ${Prefix}-${ProjectName}-${Environment}-manual-ops
      ManagedPolicyArns: 
        - !Sub "arn:${AWS::Partition}:iam::aws:policy/${ManualOpsAccountManagedPolicyName}"
 
  ManualAccessUser0001:
    Type: AWS::IAM::User
    Properties: 
      Groups: 
        - !Ref ManualAccessGroup
      UserName: !Sub ${UserName}
      Tags:
        - Key: sje:email
          Value: !Sub ${UserEmail}
        - Key: sje:purpose
          Value: interactive-access

Outputs:
  ManualAccessGroup:
    Value: !Ref ManualAccessGroup
  ManualAccessUser0001:
    Value: !Ref ManualAccessUser0001
